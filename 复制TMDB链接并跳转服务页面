// ==UserScript==
// @name         å¤åˆ¶TMDBé“¾æ¥å¹¶è·³è½¬
// @namespace    http://192.168.11.3:12280/
// @version      2.7
// @description  åœ¨TMDBé¡µé¢æ ‡é¢˜ä¸Šæ–¹æ·»åŠ å¤é€‰æ¡†ä¸æŒ‰é’®ï¼Œå¤åˆ¶é“¾æ¥å¹¶æŒ‰éœ€è·³è½¬æœ¬åœ°æœåŠ¡é¡µé¢
// @author       Copilot
// @match        https://www.themoviedb.org/*/*
// @grant        none
// @icon        https://www.themoviedb.org/assets/2/apple-touch-icon-57ed4b3b0450fd5e9a0c20f34e814b82adaa1085c79bdde2f00ca8787b63d2c4.png
// ==/UserScript==

(function () {
    'use strict';

    window.addEventListener('load', () => {
        const titleContainer = document.querySelector('.title');
        const titleEl = titleContainer?.querySelector('h2') || document.querySelector('h2[data-testid="hero-title-block__title"]');
        if (!titleContainer || !titleEl) return;

        const tmdbLink = window.location.href;

        // åˆ›å»ºå®¹å™¨
        const controlBox = document.createElement('div');
        controlBox.style.marginBottom = '10px';
        controlBox.style.display = 'flex';
        controlBox.style.alignItems = 'center';
        controlBox.style.gap = '12px';

        // åˆ›å»ºå¤é€‰æ¡†
        const checkboxLabel = document.createElement('label');
        checkboxLabel.textContent = 'æ˜¯å¦æ‰“å¼€ tmdbgen';
        checkboxLabel.style.fontSize = '0.85em';
        checkboxLabel.style.cursor = 'pointer';

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.style.verticalAlign = 'middle';
        checkbox.style.marginRight = '5px';

        checkboxLabel.prepend(checkbox);

        // åˆ›å»ºæŒ‰é’®
        const btn = document.createElement('button');
        btn.textContent = 'ğŸ“‹ è·å–å½±ç‰‡ä¿¡æ¯';
        Object.assign(btn.style, {
            padding: '4px 10px',
            fontSize: '0.85em',
            backgroundColor: '#01b4e4',
            color: '#fff',
            border: 'none',
            borderRadius: '4px',
            cursor: 'pointer',
            verticalAlign: 'middle'
        });

        btn.onclick = () => {
            navigator.clipboard.writeText(tmdbLink).then(() => {
                btn.textContent = 'âœ… é“¾æ¥å·²å¤åˆ¶';
                setTimeout(() => {
                    btn.textContent = 'ğŸ“‹ è·å–å½±ç‰‡ä¿¡æ¯';
                }, 2000);

                if (checkbox.checked) {
                    window.open('http://192.168.11.3:12280/', '_blank');
                }
            }).catch(() => {
                btn.textContent = 'âš ï¸ å¤åˆ¶å¤±è´¥';
            });
        };

        // æ’å…¥å…ƒç´ 
        controlBox.appendChild(btn);
        controlBox.appendChild(checkboxLabel);
        titleContainer.parentNode.insertBefore(controlBox, titleContainer);
    });
})();
